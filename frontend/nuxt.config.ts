// =============================================================================
// QR 자산관리 시스템 Nuxt.js 설정 파일
// =============================================================================
//
// 이 파일은 Nuxt.js 프레임워크의 설정을 담당합니다.
// 개발 환경과 운영 환경의 설정을 분리하여 관리하며,
// 빌드 최적화, 모듈 설정, 환경변수 등을 포함합니다.
//
// 주요 설정:
// - 개발 서버 포트 설정
// - 빌드 최적화 설정
// - CSS 프레임워크 (Tailwind CSS)
// - 상태 관리 (Pinia)
// - 환경별 API URL 설정
// - 보안 및 성능 최적화
//
// 작성일: 2025-01-27
// =============================================================================

// https://nuxt.com/docs/api/configuration/nuxt-config
export default defineNuxtConfig({
  // 2025-08-08: oxc-parser 네이티브 바인딩 문제 해결을 위한 ESLint 설정 추가
  eslint: {
    // oxc-parser 대신 기본 파서 사용
    config: {
      parserOptions: {
        ecmaVersion: 'latest',
        sourceType: 'module'
      }
    }
  },
  
  // =============================================================================
  // 개발 서버 설정
  // =============================================================================
  // 2024-12-19: NCP 서버 배포를 위해 포트를 3000으로 변경
  devServer: {
    port: 3000  // 프론트엔드 개발 서버 포트
  },
  
  // =============================================================================
  // Nitro 서버 설정 (Nuxt 3의 서버 엔진)
  // =============================================================================
  // 2025-01-27: nginx 없이 MIME 타입 문제 해결을 위한 설정 개선
  nitro: {
    storage: {
      redis: {
        driver: 'memory'  // 메모리 기반 스토리지 사용
      }
    },
    // 2025-08-08: 정적 파일 서빙 설정 개선
    static: {
      maxAge: 60 * 60 * 24 * 365 // 1년
    }
  },
  
  // =============================================================================
  // 실험적 기능 설정
  // =============================================================================
  // 2024-12-19: 캐시 무효화를 위한 설정
  experimental: {
    payloadExtraction: false  // 페이로드 추출 비활성화로 캐시 문제 해결
  },
  
  // =============================================================================
  // CSS 설정
  // =============================================================================
  // 전역 CSS 파일 로드
  css: ['~/assets/css/main.css'],
  
  // 2025-08-08: TypeScript 설정
  typescript: {
    strict: true,
    typeCheck: true
  },
  
  // =============================================================================
  // 모듈 설정
  // =============================================================================
  // 2025-08-08: 모듈 설정 최적화
  modules: [
    '@nuxtjs/tailwindcss',  // Tailwind CSS 프레임워크
    '@pinia/nuxt',           // Pinia 상태 관리
    '@nuxt/image'
  ],
  
  // 2025-08-08: 빌드 설정 최적화
  build: {
    transpile: ['@headlessui/vue', '@heroicons/vue']
  },
  
  // =============================================================================
  // 앱 헤더 설정
  // =============================================================================
  app: {
    head: {
      // 외부 리소스 (폰트 등) 사전 로드
      link: [
        {
          rel: 'preconnect',
          href: 'https://fonts.googleapis.com'
        },
        {
          rel: 'preconnect',
          href: 'https://fonts.gstatic.com',
          crossorigin: ''
        },
        {
          rel: 'stylesheet',
          href: 'https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap'
        }
      ]
    }
  },
  
  // =============================================================================
  // PostCSS 설정
  // =============================================================================
  // CSS 후처리 도구 설정
  postcss: {
    plugins: {
      tailwindcss: {},    // Tailwind CSS 처리
      autoprefixer: {},   // 벤더 프리픽스 자동 추가
    },
  },
  
  // =============================================================================
  // 런타임 설정 (환경변수)
  // =============================================================================
  // 2025-01-27: HTTPS 환경으로 API URL 설정 변경
  // 2025-08-08: 환경별 API 베이스 URL 설정 개선
  runtimeConfig: {
    public: {
      // =============================================================================
      // API 기본 URL 설정
      // =============================================================================
      // 개발 환경: localhost 사용
      // 운영 환경: 상대 경로 사용 (2025-01-27: localhost 호출 문제 해결)
      apiBase: process.env.NODE_ENV === 'production' ? '/api' : 'http://localhost:4000/api'
      
      // =============================================================================
      // 환경 구분 플래그
      // =============================================================================
      // 환경별 기능 분기를 위한 플래그
      isProduction: process.env.NODE_ENV === 'production',
      isDevelopment: process.env.NODE_ENV === 'development',
      
      // =============================================================================
      // 디버그 모드 설정
      // =============================================================================
      // 환경별 디버그 모드 (운영 환경에서는 비활성화)
      debugMode: process.env.NODE_ENV !== 'production'
    }
  }
})